#!/bin/sh
###############################################################################
# BleemSync Bootstapper executor v0.7
# ModMyClassic.com / https://discordapp.com/invite/8gygsrw
###############################################################################

### LOAD CONFIGURATION ########################################################
source "/media/bleemsync/etc/bleemsync/CFG/bleemsync.cfg"
source "/media/bleemsync/etc/bleemsync/CFG/boot_sequence.cfg"

### LOAD FUNCTION LIBRARIES ###################################################
source "/media/bleemsync/etc/bleemsync/FUNC/0000_shared.funcs"
source "/media/bleemsync/etc/bleemsync/FUNC/0010_execute.funcs"
source "/media/bleemsync/etc/bleemsync/FUNC/0050_bleemsync.funcs"

### EXECUTE ###################################################################
main(){
  for x in "${boot_sequence[@]}"; do
    if [ "$runtime_log" = "1" ]; then
      if [ ! -z $(echo "$x" | grep "dump_") ] && [ "$force_redump" = "1" ]; then
        $x"_func" --force &> "$runtime_log_path/bleemsync.log"
        continue
      fi
      $x"_func" &> "$runtime_log_path/bleemsync.log"
    else
      if [ ! -z $(echo "$x" | grep "dump_") ] && [ "$force_redump" = "1" ]; then
        $x"_func" --force
        continue
      fi
      $x"_func" 
    fi
  done 
}

###############################################################################
main #Do stuff and things

#If we get here... Panic and Reboot
sync
reboot
exit 1